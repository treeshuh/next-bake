<!DOCTYPE html>
<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Sacramento|Roboto' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" type="text/css" media="screen" href="recipes.css"/>
	<script type='text/javascript' src='https://code.jquery.com/jquery-2.1.4.min.js'></script>
	<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js'></script>
	<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
</head>
<body>
	<div id = "wrap">
		<ul class = "navbar">
			<li><a href = "Home Page.html">Home</a></li>

			<li><a href = #>Breads</a>
				<ul> 
					<li><a href = "Apple Bread.html">Apple Bread</a></li>
					<li><a href = "Braided Lemon Bread.html">Braided Lemon Bread</a></li>
					<li><a href = "Monkey Bread.html">Monkey Bread</a></li>
					<li><a href = "Triple Berry Cinnamon Swirl Bread.html">Triple Berry Cinnamon Swirl Bread</a></li>
				</ul>
			</li>

			<li><a href = #>Cakes/Cupcakes</a>
				<ul> 
					<li><a href = "Cheesecake.html">Cheesecake</a></li>
					<li><a href = "Chocolate Cake.html">Chocolate Cake</a></li>
					<li><a href = "Chocolate Cupcakes.html">Chocolate Cupcakes</a></li>
					<li><a href = "Vanilla Cupcakes.html">Vanilla Cupcakes</a></li>
				</ul>
			</li>

			<li><a href = #>Cookies</a>
				<ul> 
					<li><a href = "Cookies and Cream Cookies.html">Cookies and Cream Cookies</a></li>
					<li><a href = "Salted Brown Butter Pecan Cookies.html">Salted Brown Butter Pecan Cookies</a></li>
				</ul>
			</li>

			<li><a href = #>Frosting</a>
				<ul> 
					<li><a href = "Vanilla Buttercream Frosting.html">Vanilla Buttercream Frosting</a></li>
				</ul>
			</li>

			<li><a href = #>Pancakes</a>
				<ul> 
					<li><a href = "Oreo Pancakes.html">Oreo Pancakes</a></li>
				</ul>
			</li>

			<li><a href = #>Pies</a>
				<ul> 
					<li><a href = "Apple Pie.html">Apple Pie</a></li>
					<li><a href = "Banana Cream Crunch Pie.html">Banana Cream Crunch Pie</a></li>
					<li><a href = "Chocolate Cream Pie.html">Chocolate Cream Pie</a></li>
					<li><a href = "Graham Cracker Pie Crust.html">Graham Cracker Pie Crust</a></li>
					<li><a href = "Key Lime Pie.html">Key Lime Pie</a></li>
					<li><a href = "Oreo Cream Pie.html">Oreo Cream Pie</a></li>
					<li><a href = "Pecan Pie.html">Pecan Pie</a></li>
					<li><a href = "Pumpkin Pie.html">Pumpkin Pie</a></li>
				</ul>
			</li>

			<li><a href = #>Tarts</a>
				<ul> 
					<li><a href = "Apple Tart.html">Apple Tart</a></li>
				</ul>
			</li>

			<li><a href = #>Other</a>
				<ul> 
					<li><a href = "Lemon Curd.html">Lemon Curd</a></li>
					<li><a href = "Whipped Cream.html">Whipped Cream</a></li>
				</ul>
			</li>
	</div>

	<!-- Navigation to recipes by query -->
	<div class="container">
		<div data-bind="if: !recipeId()">
			<h1> Next Bake </h1>
			<p> Providing Next House with the tastiest noms around! </p>
			<p> Explore our past recipes (menu above)</p>
		</div>
		<div data-bind="if: recipeId()">
			<h3 data-bind="text: recipe().displayName">Title</h3>

			<p><span>Time: </span><!--ko text: recipe().time-->Time<!--/ko--></p>
			
			<p><span>Yields: </span><!--ko text: recipe().yields-->Yield<!--/ko--></p>

			<p><span>Recipe Link: </span><a data-bind="attr: {href: recipe().recipeLink}"><!--ko text: recipe().displayName-->Recipe Name<!--/ko--></a></p>

			<img data-bind="attr: {src: recipe().imageLink}"/>

			<p><span data-bind="visible: specialIngredients().length > 0">Special Ingredients:</span></p>
			<div data-bind="foreach: specialIngredients()">
				<input type = "checkbox"></input><label data-bind="text: $data.quantity"></label>&nbsp<label data-bind="text: $data.displayName"></label><br>
			</div>

			<p><span data-bind="visible: notes().length > 0">Notes:</span></p>
			<ul>
				<div data-bind="foreach: notes()">
					<li data-bind="text: $data"></li>
				</div>
			</ul>
		</div>
	</div>
</body>

<script>
$(document).on('ready', function(){
	var vm = function(){
		var me = this;
		var fb = new Firebase("https://next-bake.firebaseio.com/");
		var location = ko.observable(window.location.search);
		var recipeId = ko.computed(function(){
			return getQueryVariable('id')
		});

		this.recipeObj = ko.observable({});

		var recipe = ko.computed(function(){
			if (!recipeId()){
				me.recipeObj({})
				return
			}
			fb.child('recipes').child(recipeId()).once('value', function(data) {
				me.recipeObj(data.val())
			});
		});

		var specialIngredients = ko.computed(function(){
			if(!recipeObj().specialIngredients) {
				return []
			}
			ingredients = []
			keys = Object.keys(recipeObj().specialIngredients);
			for(var i=0; i < keys.length; i++){
				ingredient = recipeObj().specialIngredients[keys[i]];
				ingredients.push(ingredient);
			}
			return ingredients
		});

		var notes = ko.computed(function(){
			if(!recipeObj().notes) {
				return []
			}
			allNotes = []
			keys = Object.keys(recipeObj().notes);
			for(var i=0; i < keys.length; i++){
				note = recipeObj().notes[keys[i]];
				allNotes.push(note);
			}
			return allNotes
		});

	function getQueryVariable(variable){
       var query = location().substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
	}

    return{
    	location: location,
    	recipeId: recipeId,
    	recipe: recipeObj,
    	specialIngredients: specialIngredients,
    	notes: notes
    };

	}

	ko.applyBindings(vm());
})
</script>
</html>